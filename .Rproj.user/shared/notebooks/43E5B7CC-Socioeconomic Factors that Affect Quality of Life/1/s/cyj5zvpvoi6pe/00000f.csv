"0","dep_df <- nh %>%"
"0","  filter(!is.na(Income), !is.na(PovertyRatio), !is.na(SleepBand), !is.na(SleepTrouble)) %>%"
"0","  mutate("
"0","    IncomeQuart = cut(Income,"
"0","                      breaks = quantile(Income, probs = seq(0,1,0.25), na.rm = TRUE),"
"0","                      include.lowest = TRUE, dig.lab = 6),"
"0","    PovertyBand = cut(PovertyRatio, breaks = c(-Inf, 1, 2, 3, Inf),"
"0","                      labels = c(""<1x (Below)"", ""1–2x"", ""2–3x"", "">3x"")),"
"0","    trouble = SleepTrouble == ""Yes"""
"0","  ) %>%"
"0","  group_by(PovertyBand, IncomeQuart, SleepBand) %>%"
"0","  summarise("
"0","    n    = sum(!is.na(trouble)),"
"0","    p    = mean(trouble, na.rm = TRUE),"
"0","    se   = sqrt(p*(1-p)/n),"
"0","    lo   = pmax(0, p - 1.96*se),"
"0","    hi   = pmin(1, p + 1.96*se),"
"0","    .groups = ""drop"""
"0","  ) %>%"
"0","  filter(n >= 30)"
